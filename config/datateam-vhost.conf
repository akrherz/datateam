<VirtualHost *:80>
   ServerName datateam.agron.iastate.edu
   Redirect permanent / https://datateam.agron.iastate.edu/
</VirtualHost>

<VirtualHost _default_:443>
  ServerName datateam.agron.iastate.edu
  SSLEngine on
  SSLProtocol all -SSLv2 -SSLv3
  SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
  SSLCertificateKeyFile /etc/pki/tls/private/datateam_agron_iastate_edu.key
  SSLCertificateChainFile /etc/pki/tls/certs/datateam_agron_iastate_edu_interm.cer
  SSLCertificateFile /etc/pki/tls/certs/datateam_agron_iastate_edu.cer

  # Use a daily deadicated log file, this avoids server reloads every day
  # which are not much fun when servicing a 1,000 req/sec
  CustomLog "|/usr/sbin/rotatelogs /mesonet/www/logs/iem-%Y%m%d 86400" combined

  OIDCProviderMetadataURL https://accounts.google.com/.well-known/openid-configuration
  OIDCClientID ...
  OIDCClientSecret ...

  OIDCRedirectURI https://datateam.agron.iastate.edu/cscap/redirect_uri
  OIDCCryptoPassphrase ...
  OIDCCacheType memcache
  OIDCMemCacheServers iem-memcached
  OIDCScope "openid email profile"
  OIDCRemoteUserClaim email
  OIDCSessionInactivityTimeout 86400

  <Location /cscap/>
    AuthType openid-connect
    Require valid-user
  </Location>

  <Location /td/>
    AuthType openid-connect
    Require valid-user
  </Location>

  <Location /admin/>
    AuthType openid-connect
    Require valid-user
  </Location>

  DocumentRoot "/mesonet/www/apps/datateam/htdocs"
  <Directory "/mesonet/www/apps/datateam/htdocs">
    # Need FollowSymLinks for mod_rewrite to work!
    Options Indexes FollowSymLinks
    AllowOverride All
    Order allow,deny
    Allow from all
  </Directory>
  
  Alias /usage "/mesonet/share/usage/datateam.agron.iastate.edu/"
  <Directory "/mesonet/share/usage/datateam.agron.iastate.edu/">
    Options Indexes MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>
  
  # Since RHEL Apache does not log 404s, sigh
  ErrorDocument 404 /error404.php
  ErrorDocument 401 /error401.php
</VirtualHost>