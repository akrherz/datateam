<?php 
require_once "../../../include/require_auth.php";

function build_treatments_ui(){
	$opts = Array('TIL1', 'TIL2',
	'ROT1','ROT2',
'ROT3','ROT4',
'ROT5','ROT54',
'ROT6','ROT7',
'ROT8','ROT9',
'ROT10','ROT11',
'ROT12','ROT13',
'ROT14','ROT15',
'ROT16','ROT17',
'ROT37','ROT36',
'ROT55','ROT38',
'ROT39','ROT40',
'ROT41','ROT42',
'ROT43','ROT44',
'ROT45','ROT46',
'ROT47','ROT48',
'ROT49','ROT50',
'ROT51','ROT52',
'ROT53','ROT56',
'ROT57','ROT58',
'ROT59','ROT60',
'ROT61','ROT62',

'HERB1','HERB2',

'DWM1','DWM2',
'DWM3','DWM4',
'DWM5','DWM6',

'NIT1','NIT2',
'NIT3','NIT4',

'LND1','LND2','LND3');
	$s = '';
	while (list($k, $v)=@each($opts)){
		$s .= sprintf("<input type=\"checkbox\" value=\"%s\"".
				" data-treatment=\"%s\">%s\n",
				$v, $v, $v);
	}
	return $s;
}

function build_sites_ui(){
	$states = Array("IA" => "Iowa",
		"MN" => "Minnesota",
		"WI" => "Wisconsin",
		"IL" => "Illinois",
		"MO" => "Missouri",
		"IN" => "Indiana",
		"MI" => "Michigan",
		"OH" => "Ohio");
	$pgconn = pg_connect("dbname=mesosite host=iemdb user=nobody");
	$rs = pg_query($pgconn, "SELECT * from stations where network = 'CSCAP'".
			" ORDER by name ASC");
	$data = Array();
	for ($i=0; $row=@pg_fetch_assoc($rs, $i); $i++){
		$data[$row["state"]][$row["id"]] = $row["name"];
	}
	$keys = array_keys($data);
	asort($keys);
	$s = '';
	$q = -1;
	while (list($v,$k)=each($keys)){
		$q += 1;
		if ($q % 3 == 0){
			$s .= "<div class=\"col-md-4\">\n";
		}
		$s .= sprintf("<h3><input type=\"checkbox\" class=\"state-check\"".
				" value=\"%s\">%s</h3>\n", $k, $states[$k]);
		while (list($v2, $k2)=each($data[$k])){
			$s .= sprintf("<br /><input type=\"checkbox\" value=\"%s\"".
					" data-state=\"%s\" class=\"site-check\"".
					">%s\n", $v2, $k, $k2);
		}
		if ($q % 3 == 2){
			$s .= "</div>\n";
		}
	}
	if ($q % 3 != 2){
		$s .= "</div>\n";
	}
	return $s;
}

require_once "../../../include/myview.php";
$t = new MyView();
$t->title = "CSCAP Project Data Download";
$t->headextra = <<<EOF
<link rel="stylesheet" href="/vendor/jquery-ui/1.11.4/jquery-ui.css" />
<link rel="stylesheet" href="/vendor/jquery-ui/1.11.4/jquery-ui.theme.css" />
EOF;
$t->jsextra = <<<EOF
<script src="/vendor/jquery-ui/1.11.4/jquery-ui.js"></script>
<script src="dl.js"></script>
EOF;

$sitesui = build_sites_ui();
$treatmentui = build_treatments_ui();

$t->content = <<<EOF

<h3>CSCAP Data Download</h3>

<div class="btn-group" role="group" aria-label="Pages">
  <button type="button" class="btn btn-primary" id="sites-btn">Sites</button>
  <button type="button" class="btn btn-default" id="treatments-btn">Treatments</button>
  <button type="button" class="btn btn-default" id="agronomic-btn">Agronomic</button>
  <button type="button" class="btn btn-default" id="soil-btn">Soil</button>
  <button type="button" class="btn btn-default" id="year-btn">Year</button>
  <button type="button" class="btn btn-default" id="management-btn">Management</button>
  <button type="button" class="btn btn-default" id="option-btn">Options</button>
</div>

<div id="sites-ui" style="display: block;">
{$sitesui}
</div>
<div id="treatments-ui" style="display: none;">
	<h3>Treatments</h3>
{$treatmentui}
</div>
<div id="agronomic-ui" style="display: none;">
	<h3>Agronomic</h3>
</div>
<div id="soil-ui" style="display: none;">
	<h3>Soil</h3>
</div>
<div id="year-ui" style="display: none;">
	<h3>Years</h3>
</div>
<div id="management-ui" style="display: none;">
	<h3>Management</h3>
</div>
<div id="option-ui" style="display: none;">
	<h3>Options</h3>
</div>
		
		
<br clear="both" />
<div class="pull-right">
<button id="prev-btn" type="button" class="btn btn-default"><i class="glyphicon glyphicon-arrow-left"></i> Previous</button>
<button id="next-btn" type="button" class="btn btn-default">Next <i class="glyphicon glyphicon-arrow-right"></i></button>
</div>
EOF;
$t->render('single.phtml');

?>